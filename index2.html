<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tupã Weather Dashboard (Enhanced Glassmorphism)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS DA SPLASH SCREEN (DO CÓDIGO 1) --- */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #00c6ff, #0072ff); 
            z-index: 9999; display: flex; justify-content: center; align-items: center;
            text-align: center; color: white; opacity: 1; visibility: visible;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }
        #splash-screen.hidden { opacity: 0; visibility: hidden; }
        .splash-content { max-width: 500px; padding: 20px; }
        /* Placeholder para logo, ajuste conforme necessário */
        .splash-logo { 
            width: 150px; 
            margin-bottom: 20px; 
            /* Se for usado fora da splash, o margin-bottom é o principal */
        } 
        .splash-description { font-size: 1.1rem; line-height: 1.6; color: rgba(255, 255, 255, 0.85); }
        .sponsor-section { margin-top: 40px; border-top: 1px solid rgba(255, 255, 255, 0.2); padding-top: 20px; }
        .sponsor-text { display: block; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7); margin-bottom: 10px; }
        /* Placeholder para logo do patrocinador, ajuste conforme necessário */
        .sponsor-logo { max-width: 120px; opacity: 0.8; } 

        /* Estilos do Botão de Entrada da Splash Screen */
        #enter-btn {
            position: fixed; bottom: 40px; right: 40px;
            width: 60px; height: 60px;
            border-radius: 50%; border: 1px solid rgba(255, 255, 255, 0.3);
            background-color: rgba(255, 255, 255, 0.15); backdrop-filter: blur(10px);
            color: white; font-size: 2rem; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            z-index: 10000; /* Acima da Splash */
        }
        #enter-btn:hover { background-color: rgba(255, 255, 255, 0.3); transform: scale(1.1); animation: none; }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
        }
        /* --- FIM ESTILOS DA SPLASH SCREEN --- */


        /* Oculta a navegação e o conteúdo principal inicialmente */
        .header-nav.hidden-initial,
        .dashboard-container.hidden-initial {
            display: none !important;
        }

        /* Mantido do Código 2 */
        body {
            /* Fundo de gradiente vibrante */
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            padding-top: 80px; 
            /* Aplica a fonte Poppins */
            font-family: 'Poppins', sans-serif;
        }

        /* --- NOVO ESTILO PARA O CABEÇALHO --- */
        .header-nav {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1030; 
            padding: 10px 0;
            /* Usa o estilo glass-card como base */
            background-color: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid rgba(255, 255, 255, 0.4); 
            box-shadow: 0 4px 12px 0 rgba(31, 38, 135, 0.37);
        }
        
        /* ... outros estilos mantidos do Código 2 ... */
        
        .header-nav a.nav-link {
            color: #f8f9fa !important; 
            font-weight: 500;
            transition: color 0.3s ease, border-bottom 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .header-nav a.nav-link:hover,
        .header-nav a.nav-link.active { 
            color: #f7e8aa !important; 
            border-bottom: 2px solid #f7e8aa;
        }
        
        .header-nav .navbar-brand {
            font-weight: 700;
            color: #ffffff !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            margin-left: 10px;
        }

        .dashboard-container {
            max-width: 1200px;
            flex-grow: 1; 
            margin-top: auto !important; 
            margin-bottom: auto !important;
        }

        .glass-card {
            /* Glassmorphism Aprimorado */
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.4); 
            border-radius: 20px; 
            /* Sombra colorida para "levantar" o card */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        
        .glass-card:hover {
            transform: translateY(-5px); 
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
        }

        .glass-input {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            transition: background-color 0.3s;
        }

        .glass-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .glass-input:focus {
            background-color: rgba(255, 255, 255, 0.25); 
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 0 0.25rem rgba(255, 255, 255, 0.4);
            color: white;
        }

        /* Enfatiza os ícones */
        .icon-large {
            font-size: 2.8rem; 
            color: #b3e5fc; 
            margin-right: 15px !important;
            transition: color 0.5s ease; 
        }

        /* Classes de cor para a Temperatura */
        .icon-red {
            color: #ff5757 !important; 
        }

        .icon-yellow {
            color: #ffc107 !important; 
        }

        .icon-blue {
            color: #33aaff !important; 
        }
        
        /* Classes de cor para a Chuva */
        .icon-rain-low {
            color: #a0c4ff !important; 
        }
        .icon-rain-moderate {
            color: #6c9afc !important; 
        }
        .icon-rain-high {
            color: #f7e8aa !important; 
        }

        .text-white {
            color: #f8f9fa !important;
        }

        .text-white-50 {
            color: rgba(248, 249, 250, 0.8) !important;
            font-weight: 300;
        }

        /* Rótulo do Dado: Mantido em destaque */
        .card-text.text-white-50.small {
            font-size: 1rem; 
            font-weight: 600; 
            color: #ffffff !important; 
            opacity: 1;
            margin-bottom: 0.5rem !important; 
        }

        /* Estilo do Título Principal */
        .main-header {
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); 
        }

        /* Destaque para Local e Data */
        #location-display {
            font-size: 2rem !important;
            font-weight: 600;
            color: #ffffff; 
        }
        #date-display {
            font-size: 1.1rem !important;
            font-weight: 500;
            color: #f7e8aa; 
        }

        /* VALOR PRINCIPAL */
        .card-title.main-value {
            font-size: 2rem; 
            font-weight: 600;
            color: #e0ffff; 
            line-height: 1; 
        }
        
        /* Estilo para a caixa das Coordenadas */
        #coords-display-wrapper {
            background-color: rgba(255, 255, 255, 0.1); 
            padding: 8px 15px; 
            border-radius: 10px;
            margin-top: 15px; 
            margin-bottom: 20px; 
            text-align: center; 
            display: none; 
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
        }

        /* Estilos de Botão Primário */
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.5);
        }

        /* Estilo do Botão Download CSV (Amarelo Pastel) */
        .btn-pastel-yellow {
            background-color: #f7e8aa; 
            border-color: #f7e8aa;
            color: #333333; 
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-pastel-yellow:hover {
            background-color: #e6d38e; 
            border-color: #e6d38e;
            color: #333333;
            box-shadow: 0 4px 10px rgba(247, 232, 170, 0.5);
        }

        /* Style to center the spinner */
        #loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        /* Estilo para o Rodapé (Copyright) */
        footer {
            width: 100%;
            margin-top: 40px; 
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            font-weight: 300;
        }

        /* Estilo para o link de Copyright */
        footer a {
            color: rgba(255, 255, 255, 0.9) !important; 
            text-decoration: none !important; 
            transition: text-decoration 0.2s ease; 
        }

        /* Efeito ao passar o mouse */
        footer a:hover {
            text-decoration: underline !important; 
            color: #ffffff !important; 
        }

        /* Estilo para a nova seção de conteúdo da Home e About (compartilhado) */
        .content-card {
            padding: 30px;
            color: white;
            max-width: 800px;
            margin: 40px auto; 
            text-align: justify;
        }
        
        .content-card h2 {
            font-weight: 700;
            color: #f7e8aa;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(247, 232, 170, 0.5);
            padding-bottom: 8px;
        }
        
        .content-card p {
            font-weight: 400;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Estilos específicos para a caixa de contato */
        #contact-content a {
            color: #b3e5fc; /* Cor do link */
            transition: color 0.3s ease;
        }

        #contact-content a:hover {
            color: #ffffff; 
        }
    </style>
</head>
<body>
    
    <div id="splash-screen">
        <div class="splash-content">
            <img src="logo.png" alt="Logo Tupã" class="splash-logo"> 
            <p class="splash-description my-4">
                Your climate data visualization dashboard.
            </p>
            <div class="sponsor-section">
                <span class="sponsor-text">Patrocinado por:</span>
                <img src="space_apps.png" alt="Logo do Patrocinador" class="sponsor-logo">
            </div>
        </div>
        <button id="enter-btn">
            <i class="bi bi-arrow-right-short"></i>
        </button>
    </div>
    
    <nav class="navbar navbar-expand-lg header-nav hidden-initial" id="main-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" id="brand-link" data-page="dashboard">
                <i class="bi bi-cloud-sun-fill me-2"></i> Tupã Weather
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#" data-page="dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="about">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-page="contact-placeholder">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5 dashboard-container hidden-initial" id="main-content-container">
        
        <div id="about-content" class="glass-card content-card" style="display: none;">
            
            <h1 class="text-center text-white mb-4 main-header">Project Information</h1>

            <h2>About the Team</h2>
            <p>
                We are a team dedicated to turning complex Earth observation data into accessible and practical information for everyday life. Our goal is to help users plan outdoor activities—such as hiking, trips, or fishing—by providing detailed forecasts of weather conditions. We developed an application with a custom interface that allows users to perform specific queries to identify the likelihood of **“very hot,” “very cold,” “very windy,” “very humid,” or “very uncomfortable”** conditions at any chosen location and time. Our team combines expertise in data science, meteorology, and intuitive interface design to make outdoor activity planning safer, more comfortable, and more efficient.
            </p>

            <h2>About the Challenge</h2>
            <p>
                If you’re planning an outdoor event—like a vacation, a hike on a trail, or fishing on a lake—it would be good to know the chances of adverse weather for the time and location you are considering. There are many types of Earth observation data that can provide information on weather conditions for a particular location and day of the year. Your challenge is to construct an app with a personalized interface that enables users to conduct a customized query to tell them the likelihood of **“very hot,” “very cold,” “very windy,” “very wet,” or “very uncomfortable”** conditions for the location and time they specify. (Earth Science Division)
            </p>
            
        </div>

        <div id="contact-content" class="glass-card content-card" style="display: none; text-align: center;">
            <h1 class="text-center text-white mb-4 main-header">Get in Touch</h1>

            <p style="font-size: 1.1rem; margin-bottom: 30px; color: rgba(255, 255, 255, 0.9);">
                Have questions about the data, project collaboration, or sponsorship opportunities? Contact our team directly.
            </p>

            <div class="row g-3 justify-content-center">
                
                <div class="col-md-8">
                    <div class="glass-card p-4 mx-auto" style="border: 1px solid rgba(255, 255, 255, 0.5);">
                        <h2 class="text-white mb-3" style="border-bottom: none; color: #f7e8aa !important; font-size: 1.5rem;">Contact Emails</h2>
                        
                        <div class="d-flex align-items-center mb-3 text-start">
                            <i class="bi bi-envelope-open-fill icon-large me-3" style="font-size: 1.8rem; color: #b3e5fc;"></i>
                            <div>
                                <p class="card-text text-white-50 small mb-0" style="font-weight: 400; font-size: 0.9rem;">General Inquiries / Support</p>
                                <a href="mailto:arthur.rats@aluno.ufca.edu.br">arthur.rats@aluno.ufca.edu.br</a>
                                <a href="mailto:pedro.simeao@aluno.ufca.edu.br">pedro.simeao@aluno.ufca.edu.br</a>
                                <a href="mailto:leonardo.pereira@aluno.ufca.edu.br">leonardo.pereira@aluno.ufca.edu.br</a>
                                <a href="mailto:riquelme.jatay@aluno.ufca.edu.br">riquelme.jatay@aluno.ufca.edu.br</a>
                                <a href="mailto:raissa.karoliny@aluno.ufca.edu.br">raissa.karoliny@aluno.ufca.edu.br</a>
                            </div>
                        </div>


                    </div>
                </div>
            </div>
        </div>

        <div id="dashboard-content" style="display: block;"> 
            <h1 class="text-center text-white mb-5 main-header">
                Tupã Dashboard <br>
                <span class="fs-4 d-block" id="location-display"></span>
                <span class="fs-6 d-block text-white-50" id="date-display"></span>
            </h1>

            <div class="row">
                <div class="col-lg-4 mb-4">
                    <div class="card glass-card p-4 h-100 d-flex flex-column justify-content-between">
                        <form id="weather-form">
                            <h5 class="card-title text-white mb-3" style="font-weight: 600;">Search Weather</h5>
                            <div class="mb-3">
                                <label for="location_input" class="form-label text-white-50">Location</label>
                                <input type="text" class="form-control glass-input" id="location_input" name="location_input" placeholder="Ex: Juazeiro do Norte, Brazil">
                            </div>
                            <div class="mb-3">
                                <label for="date_input" class="form-label text-white-50">Date</label>
                                <input type="date" class="form-control glass-input" id="date_input" name="date_input">
                            </div>
                            
                            <div id="coords-display-wrapper">
                                Coordinates: <span id="coords-display">Lat: --, Lon: --</span>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary">Update</button>
                                <button type="button" class="btn btn-pastel-yellow" id="download-csv-btn" disabled>Download CSV</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="col-lg-8">
                    <div id="loading-spinner" class="d-flex justify-content-center d-none" style="min-height: 400px;">
                        <div class="spinner-border text-white" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>

                    <div class="row row-cols-1 row-cols-md-3 g-4" id="weather-data-container">
                        
                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Average Temperature</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-thermometer-half icon-large" id="temp-icon"></i> 
                                        <h3 class="card-title mb-0 main-value" id="current-temp">--°C</h3>
                                    </div>
                                    <p class="card-text small text-white-50">
                                        Max. <span id="max-temp">--</span>, Min. <span id="min-temp">--</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Relative Humidity</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-cloud-haze2-fill icon-large"></i> 
                                        <h3 class="card-title mb-0 main-value" id="current-humidity">--%</h3>
                                    </div>
                                    <p class="card-text small text-white-50">Water content in the air.</p>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Wind Speed</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-wind icon-large"></i> 
                                        <h3 class="card-title mb-0 main-value" id="current-wind">-- m/s</h3>
                                    </div>
                                    <p class="card-text small text-white-50">Measured at 10 meters height.</p>
                                </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Solar Irradiation</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-sun icon-large"></i>
                                        <h3 class="card-title mb-0 main-value" id="solar-radiation">-- kWh/m²</h3>
                                    </div>
                                    <p class="card-text small text-white-50">Solar energy reaching the surface.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Atmospheric Pressure</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-speedometer icon-large"></i>
                                        <h3 class="card-title mb-0 main-value" id="pressure">-- hPa</h3>
                                    </div>
                                    <p class="card-text small text-white-50">Approximate sea- level pressure.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col">
                            <div class="card glass-card h-100">
                                <div class="card-body text-white">
                                    <p class="card-text text-white-50 small">Rain (Probability)</p>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="bi bi-cloud-rain icon-large" id="rain-icon"></i> 
                                        <h3 class="card-title mb-0 main-value" id="rain-prob">--%</h3>
                                    </div>
                                    <p class="card-text small text-white-50">Based on humidity and precipitable water data.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    <footer class="text-center py-3">
        <p class="m-0">
            &copy; 2025 <a href="https://www.spaceappschallenge.org/2025/find-a-team/tupa1/">Tupã Weather Dashboard</a>. All rights reserved.
            <br>
            Data provided by NASA Prediction Of Worldwide Energy Resources (POWER).
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        let weatherData = null;
        
        // Defines the Bootstrap icons for each rain range
        const rainIcons = {
            low: 'bi-cloud-drizzle-fill', 
            moderate: 'bi-cloud-rain', 
            high: 'bi-cloud-lightning-rain-fill'
        };
        
        // Defines the rain color classes
        const rainColors = {
            low: 'icon-rain-low',
            moderate: 'icon-rain-moderate',
            high: 'icon-rain-high'
        };

        // Geocoding Function (No Changes)
        async function geocodeNominatim(place) {
            const q = encodeURIComponent(place);
            const url = `https://nominatim.openstreetmap.org/search?q=${q}&format=json&limit=1&addressdetails=1`;
            
            const resp = await fetch(url, {
                headers: {
                    'Accept-Language': 'en-US',
                    'User-Agent': 'tupã/1.0 (phbs.va@gmail)'
                }
            });
            if (!resp.ok) throw new Error(`Error: ${resp.status}`);
            const results = await resp.json();
            if (results.length === 0) return null;
            return {
                display_name: results[0].display_name,
                lat: parseFloat(results[0].lat),
                lon: parseFloat(results[0].lon),
                raw: results
            };
        }

        // Function to update Thermometer icon color (No Changes)
        function updateThermometerColor(iconElement, temperature) {
            iconElement.classList.remove('icon-red', 'icon-yellow', 'icon-blue');

            // Color Logic: Red (>30), Yellow (18-30), Blue (<18)
            if (temperature > 30) {
                iconElement.classList.add('icon-red');
            } else if (temperature >= 18 && temperature <= 30) {
                iconElement.classList.add('icon-yellow');
            } else if (temperature < 18) {
                iconElement.classList.add('icon-blue');
            }
        }
        
        // Function to update Rain icon and color (No Changes)
        function updateRainIcon(iconElement, rainProbability) {
            // Remove all possible icons and colors
            Object.values(rainIcons).forEach(cls => iconElement.classList.remove(cls));
            Object.values(rainColors).forEach(cls => iconElement.classList.remove(cls));

            let iconClass = rainIcons.moderate;
            let colorClass = rainColors.moderate;

            if (rainProbability <= 30) {
                iconClass = rainIcons.low;
                colorClass = rainColors.low;
            } else if (rainProbability > 60) {
                iconClass = rainIcons.high;
                colorClass = rainColors.high;
            }
            
            // Apply the correct icon and color
            iconElement.classList.add(iconClass);
            iconElement.classList.add(colorClass);
        }

        // CSV Download Function (MANTIDA)
        function generateAndDownloadCsv(data, location, date) {
            const temp = data.T2M.toFixed(1);
            const humidity = data.RH2M.toFixed(1);
            const wind = data.WS10M.toFixed(2);
            const solar = data.ALLSKY_SFC_SW_DWN.toFixed(2);
            const pressure = data.PS.toFixed(2);
            const rainProb = data.rainProb;
            const pw = data.PW.toFixed(2);

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Metric,Value,Unit\n";
            csvContent += `Location,${location},N/A\n`;
            csvContent += `Date,${date},N/A\n`;
            csvContent += `Temperature,${temp},°C\n`;
            csvContent += `Relative_Humidity,${humidity},%\n`;
            csvContent += `Wind_Speed,${wind},m/s\n`;
            csvContent += `Solar_Irradiation,${solar},kWh/m²\n`;
            csvContent += `Atmospheric_Pressure,${pressure},hPa\n`;
            csvContent += `Rain_Probability,${rainProb},%\n`;
            csvContent += `Precipitable_Water,${pw},kg/m²\n`;

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Tupa_Weather_Data_${location.replace(/[^a-zA-Z0-9]/g, '_')}_${date.replace(/[^a-zA-Z0-9]/g, '_')}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


        // Função de Cálculo de Probabilidade de Chuva 
        function calculateRainProbability(data) {
            let p = 0.1;
            
            if (data.RH2M > 80) p += 0.3;
            else if (data.RH2M > 60) p += 0.2;
            else if (data.RH2M > 40) p += 0.1;
            
            if (data.PW > 20) p += 0.3;
            else if (data.PW > 10) p += 0.15;
            
            if (data.ALLSKY_SFC_SW_DWN < 100) p += 0.3;
            else if (data.ALLSKY_SFC_SW_DWN < 200) p += 0.15;
            
            if (data.T2M > 35) p -= 0.2;
            else if (data.T2M > 30) p -= 0.1;
            
            return Math.round(Math.max(0, Math.min(1, p)) * 100);
        }
        
        // Função de atualização da UI
        function updateUI(data) {
            const temp = data.T2M;

            document.getElementById('current-temp').textContent = `${temp.toFixed(1)}°C`;
            document.getElementById('max-temp').textContent = `N/A`; 
            document.getElementById('min-temp').textContent = `N/A`; 
            document.getElementById('current-humidity').textContent = `${data.RH2M.toFixed(1)}%`;
            document.getElementById('current-wind').textContent = `${data.WS10M.toFixed(1)} m/s`;
            document.getElementById('solar-radiation').textContent = `${data.ALLSKY_SFC_SW_DWN.toFixed(2)} kWh/m²`; 
            document.getElementById('pressure').textContent = `${data.PS.toFixed(1)} hPa`;
            document.getElementById('rain-prob').textContent = `${data.rainProb}%`;

            updateThermometerColor(document.getElementById('temp-icon'), temp);
            updateRainIcon(document.getElementById('rain-icon'), data.rainProb);
        }

        // Função de busca de dados NASA POWER 
        async function getAndUpdateWeather(lat, lon, date) {
            let queryDate = new Date(date);
            const mouthDate = new Date('2025-10-01');

            if (queryDate > mouthDate) {
                queryDate.setDate(queryDate.getDate() - 365);
            }

            const startDate = queryDate.toISOString().split('T')[0].replace(/-/g, "");
            
            const params = new URLSearchParams({
                start: startDate,
                end: startDate,
                latitude: lat,
                longitude: lon,
                parameters: "T2M,RH2M,PW,ALLSKY_SFC_SW_DWN,WS10M,PS",
                community: "AG",
                format: "JSON",
                temporal: "daily"
            });
            
            const baseUrl = "https://power.larc.nasa.gov/api/temporal/daily/point";
            const url = `${baseUrl}?${params.toString()}`;
            
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`Request error: ${response.status} ${response.statusText}`);
            }
            const data = await response.json();
            const parameters = data.properties.parameter;
            
            const dailyData = {
                T2M: parameters.T2M[startDate],
                RH2M: parameters.RH2M[startDate],
                PW: parameters.PW[startDate],
                ALLSKY_SFC_SW_DWN: parameters.ALLSKY_SFC_SW_DWN[startDate],
                WS10M: parameters.WS10M[startDate],
                PS: parameters.PS[startDate]
            };
            
            // Calculando a probabilidade de chuva
            const prob = calculateRainProbability(dailyData); 
            
            weatherData = { ...dailyData, rainProb: prob };
            updateUI(weatherData);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('weather-form');
            const locationInput = document.getElementById('location_input');
            const dateInput = document.getElementById('date_input');
            const coordsDisplay = document.getElementById('coords-display');
            const coordsWrapper = document.getElementById('coords-display-wrapper'); 
            const locationDisplay = document.getElementById('location-display');
            const dateDisplay = document.getElementById('date-display');
            const downloadBtn = document.getElementById('download-csv-btn');
            const loadingSpinner = document.getElementById('loading-spinner');
            const weatherContainer = document.getElementById('weather-data-container');
            
            // Novos elementos de controle de página
            const aboutContent = document.getElementById('about-content'); 
            const contactContent = document.getElementById('contact-content'); // REFERÊNCIA AO NOVO CONTEÚDO
            const dashboardContent = document.getElementById('dashboard-content');
            const navLinks = document.querySelectorAll('.nav-link');
            const brandLink = document.getElementById('brand-link');
            
            // Elementos para a Splash Screen
            const splashScreen = document.getElementById('splash-screen');
            const enterButton = document.getElementById('enter-btn');
            const mainNavbar = document.getElementById('main-navbar');
            const mainContentContainer = document.getElementById('main-content-container');

            // --- LÓGICA DA SPLASH SCREEN INTEGRADA ---
            enterButton.addEventListener('click', () => {
                splashScreen.classList.add('hidden'); // Esconde a splash screen
                // Remove as classes iniciais e exibe o conteúdo principal
                mainNavbar.classList.remove('hidden-initial');
                mainContentContainer.classList.remove('hidden-initial');
                mainNavbar.style.display = 'flex'; // Garante que a navbar fixa seja exibida
                // VAI DIRETO PARA O DASHBOARD
                showPage('dashboard'); 
            });
            // --- FIM DA LÓGICA DA SPLASH SCREEN ---

            // Adiciona listener ao brand-link para voltar para o Dashboard
            brandLink.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('dashboard'); 
            });
            
            // Função para alternar entre as visualizações - ATUALIZADA
            function showPage(pageId) {
                // Esconde tudo
                aboutContent.style.display = 'none';
                dashboardContent.style.display = 'none';
                contactContent.style.display = 'none'; // ESCONDE CONTACT
                
                // Mostra a página correta
                if (pageId === 'dashboard') {
                    dashboardContent.style.display = 'block';
                } else if (pageId === 'about') { 
                    aboutContent.style.display = 'block';
                    // Limpa os títulos do dashboard ao sair dele
                    locationDisplay.textContent = ""; 
                    dateDisplay.textContent = "";
                } else if (pageId === 'contact-placeholder') { // MOSTRA CONTACT
                    contactContent.style.display = 'block'; 
                    // Limpa os títulos do dashboard ao sair dele
                    locationDisplay.textContent = ""; 
                    dateDisplay.textContent = "";
                }

                // Atualiza o link ativo no cabeçalho
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    // Verifica se o link é para o Dashboard, About ou Contact
                    if (link.getAttribute('data-page') === pageId) {
                        link.classList.add('active');
                    }
                });
            }

            // Adiciona listeners aos links de navegação
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    
                    // Inclui 'contact-placeholder'
                    if (page === 'dashboard' || page === 'about' || page === 'contact-placeholder') { 
                        showPage(page);
                    } else {
                        // Para qualquer outro placeholder
                        navLinks.forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        
                        if (page.includes('placeholder')) {
                             alert(`Navigation to "${page.split('-')[0]}" is not yet implemented.`);
                        }
                    }
                });
            });


            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const place = locationInput.value;
                const date = dateInput.value;
                
                if (!place || !date) {
                    alert('Please fill in the location name and date.'); 
                    return;
                }
                
                weatherContainer.classList.add('d-none');
                coordsWrapper.style.display = 'none'; 
                loadingSpinner.classList.remove('d-none');
                downloadBtn.disabled = true;
                
                try {
                    const coords = await geocodeNominatim(place);
                    
                    if (!coords) {
                        alert('Location not found. Try a more specific name.'); 
                        return;
                    }
                    
                    const { lat, lon, display_name } = coords;
                    locationDisplay.textContent = display_name.split(',')[0]; 
                    coordsDisplay.textContent = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
                    coordsWrapper.style.display = 'block'; 
                    // Use 'en-US' for English date formatting 
                    dateDisplay.textContent = new Date(date).toLocaleDateString('en-US', { dateStyle: 'long' }); 
                    await getAndUpdateWeather(lat, lon, date);
                    downloadBtn.disabled = false;
                } catch (error) {
                    console.error("Error fetching data:", error);
                    alert("Could not load data. Please try again or check the console."); 
                } finally {
                    loadingSpinner.classList.add('d-none');
                    weatherContainer.classList.remove('d-none');
                }
            });

            downloadBtn.addEventListener('click', () => {
                if (weatherData) {
                    generateAndDownloadCsv(weatherData, locationDisplay.textContent, dateDisplay.textContent);
                } else {
                    alert('No data to download. Update the weather first.'); 
                }
            });
            
            // Define a data inicial como hoje, se o campo estiver vazio
            if (!dateInput.value) {
                dateInput.valueAsDate = new Date();
            }
        });
        
    </script>
</body>
</html>
